<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador de Visitantes en Tiempo Real</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            padding: 40px;
            text-align: center;
            max-width: 600px;
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .description {
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
            font-size: 1.1em;
        }
        
        .counter-container {
            position: relative;
            margin: 30px 0;
        }
        
        .counter-circle {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .counter-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 50%, rgba(255,255,255,0.1) 50%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0.5; }
        }
        
        .counter {
            font-size: 5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .status {
            margin-top: 20px;
            font-size: 1.2em;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            font-weight: bold;
        }
        
        .status.online {
            background: rgba(76, 175, 80, 0.2);
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        
        .status.offline {
            background: rgba(244, 67, 54, 0.2);
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        .visitors-history {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
        }
        
        .visitors-history h3 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .connection-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        .connection-dot.connected {
            background: #4CAF50;
        }
        
        .connection-dot.disconnected {
            background: #f44336;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            margin-top: 30px;
            color: #666;
            font-size: 0.9em;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .counter-circle {
                width: 150px;
                height: 150px;
            }
            
            .counter {
                font-size: 3.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Contador de Visitantes</h1>
        
        <p class="description">
            Este sistema muestra en tiempo real cu√°ntas personas est√°n navegando por este sitio.
            El contador se actualiza autom√°ticamente cuando alguien entra o sale.
        </p>
        
        <div class="connection-status">
            <div class="connection-dot connected" id="connectionDot"></div>
            <span id="connectionStatus">Conectado a Firebase</span>
        </div>
        
        <div class="counter-container">
            <div class="counter-circle">
                <div class="counter" id="visitorCount">0</div>
            </div>
        </div>
        
        <div class="status online" id="statusMessage">
            Hay <span id="currentCount">0</span> visitantes en l√≠nea ahora mismo
        </div>
        
        <div class="visitors-history">
            <h3>üìä Historial de Visitantes</h3>
            <div id="historyList">
                <div class="history-item">
                    <span>Cargando...</span>
                    <span class="loading"></span>
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h4>‚ÑπÔ∏è ¬øC√≥mo funciona?</h4>
            <p>1. Cada visitante genera un ID √∫nico al cargar la p√°gina</p>
            <p>2. Firebase actualiza el contador en tiempo real para todos</p>
            <p>3. Los visitantes se eliminan autom√°ticamente al cerrar la pesta√±a</p>
            <p>4. El sistema funciona 100% en GitHub Pages</p>
        </div>
        
        <footer>
            <p>√öltima actualizaci√≥n: <span id="lastUpdate">--:--:--</span></p>
            <p>Tu ID de sesi√≥n: <code id="sessionId">Generando...</code></p>
            <p>Este contador usa Firebase Realtime Database</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN DE FIREBASE - ¬°REEMPLAZA ESTO!
        // ============================================
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDVZd-4iHdxrzA4Cl8YvJSeE_ZmCpAr1u0",
  authDomain: "visit-7dc8d.firebaseapp.com",
  databaseURL: "https://visit-7dc8d-default-rtdb.firebaseio.com",
  projectId: "visit-7dc8d",
  storageBucket: "visit-7dc8d.firebasestorage.app",
  messagingSenderId: "257245983162",
  appId: "1:257245983162:web:f1b5b33a8762c9586aed83",
  measurementId: "G-LCC1K2K0GB"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Elementos DOM
        const visitorCountElement = document.getElementById('visitorCount');
        const currentCountElement = document.getElementById('currentCount');
        const statusMessage = document.getElementById('statusMessage');
        const historyList = document.getElementById('historyList');
        const lastUpdate = document.getElementById('lastUpdate');
        const sessionIdElement = document.getElementById('sessionId');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionDot = document.getElementById('connectionDot');
        
        // Variables globales
        let sessionId = generateSessionId();
        let currentVisitors = {};
        let isOnline = true;
        
        sessionIdElement.textContent = sessionId;
        
        // Generar ID √∫nico para esta sesi√≥n
        function generateSessionId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Formatear fecha
        function formatTime(date) {
            return date.toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // Actualizar hora de √∫ltima actualizaci√≥n
        function updateLastUpdate() {
            lastUpdate.textContent = formatTime(new Date());
        }
        
        // Conectar con Firebase
        function connectToFirebase() {
            try {
                // Referencia a los visitantes en Firebase
                const visitorsRef = database.ref('visitors');
                
                // Escuchar cambios en los visitantes
                visitorsRef.on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        currentVisitors = snapshot.val();
                        updateVisitorCount();
                        updateHistoryList();
                        updateLastUpdate();
                        
                        if (!isOnline) {
                            setOnlineStatus(true);
                        }
                    } else {
                        currentVisitors = {};
                        updateVisitorCount();
                    }
                });
                
                // Manejar desconexi√≥n/reconexi√≥n
                database.ref('.info/connected').on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        setOnlineStatus(true);
                        // Registrar este visitante
                        registerVisitor();
                    } else {
                        setOnlineStatus(false);
                    }
                });
                
                // Registrar este visitante
                registerVisitor();
                
            } catch (error) {
                console.error('Error con Firebase:', error);
                setOnlineStatus(false);
            }
        }
        
        // Registrar este visitante
        function registerVisitor() {
            const visitorRef = database.ref('visitors/' + sessionId);
            
            // Establecer datos del visitante
            visitorRef.set({
                timestamp: Date.now(),
                userAgent: navigator.userAgent,
                lastSeen: Date.now()
            });
            
            // Actualizar cada 10 segundos para mantener activo
            setInterval(() => {
                if (isOnline) {
                    visitorRef.update({
                        lastSeen: Date.now()
                    });
                }
            }, 10000);
            
            // Eliminar este visitante cuando se cierre la p√°gina
            window.addEventListener('beforeunload', () => {
                visitorRef.remove();
            });
        }
        
        // Actualizar contador de visitantes
        function updateVisitorCount() {
            const count = Object.keys(currentVisitors).length;
            const previousCount = parseInt(visitorCountElement.textContent) || 0;
            
            // Actualizar n√∫meros
            visitorCountElement.textContent = count;
            currentCountElement.textContent = count;
            
            // Animaci√≥n
            if (count > previousCount) {
                animateIncrease();
                showNotification(`üë§ Nuevo visitante! (Total: ${count})`, 'online');
            } else if (count < previousCount) {
                animateDecrease();
                showNotification(`üëã Visitante desconectado (Quedan: ${count})`, 'offline');
            }
            
            // Actualizar mensaje de estado
            updateStatusMessage(count);
        }
        
        // Actualizar lista de historial
        function updateHistoryList() {
            historyList.innerHTML = '';
            
            const now = Date.now();
            const visitorsArray = Object.entries(currentVisitors)
                .sort((a, b) => b[1].timestamp - a[1].timestamp)
                .slice(0, 10); // Mostrar solo los 10 m√°s recientes
            
            if (visitorsArray.length === 0) {
                historyList.innerHTML = '<div class="history-item">No hay visitantes activos</div>';
                return;
            }
            
            visitorsArray.forEach(([id, data]) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const timeDiff = Math.floor((now - data.timestamp) / 1000);
                const minutes = Math.floor(timeDiff / 60);
                const seconds = timeDiff % 60;
                
                let timeText;
                if (timeDiff < 60) {
                    timeText = `Hace ${timeDiff} segundos`;
                } else {
                    timeText = `Hace ${minutes} min ${seconds} seg`;
                }
                
                // Detectar dispositivo
                let device = 'üåê Navegador';
                const ua = data.userAgent || '';
                if (ua.includes('Mobile')) device = 'üì± M√≥vil';
                if (ua.includes('Android')) device = 'ü§ñ Android';
                if (ua.includes('iPhone')) device = 'üì± iPhone';
                if (ua.includes('iPad')) device = 'üì± iPad';
                if (ua.includes('Windows')) device = 'üíª Windows';
                if (ua.includes('Mac')) device = 'üçé Mac';
                
                item.innerHTML = `
                    <div>
                        <strong>${device}</strong>
                        <div style="font-size: 0.8em; color: #666;">${id === sessionId ? 'T√∫' : 'Visitante'}</div>
                    </div>
                    <div style="text-align: right;">
                        ${timeText}
                    </div>
                `;
                
                historyList.appendChild(item);
            });
        }
        
        // Actualizar mensaje de estado
        function updateStatusMessage(count) {
            let message = '';
            
            if (count === 0) {
                message = 'No hay visitantes en l√≠nea';
                statusMessage.className = 'status offline';
            } else if (count === 1) {
                message = 'Hay 1 visitante en l√≠nea (¬°t√∫!)';
                statusMessage.className = 'status online';
            } else {
                message = `Hay ${count} visitantes en l√≠nea ahora mismo`;
                statusMessage.className = 'status online';
            }
            
            statusMessage.textContent = message;
        }
        
        // Establecer estado de conexi√≥n
        function setOnlineStatus(online) {
            isOnline = online;
            
            if (online) {
                connectionStatus.textContent = 'Conectado a Firebase';
                connectionDot.className = 'connection-dot connected';
                connectionStatus.style.color = '#4CAF50';
            } else {
                connectionStatus.textContent = 'Desconectado - Intentando reconectar...';
                connectionDot.className = 'connection-dot disconnected';
                connectionStatus.style.color = '#f44336';
            }
        }
        
        // Animaci√≥n para aumento
        function animateIncrease() {
            visitorCountElement.style.transform = 'scale(1.2)';
            visitorCountElement.style.color = '#4CAF50';
            
            setTimeout(() => {
                visitorCountElement.style.transform = 'scale(1)';
                visitorCountElement.style.color = 'white';
            }, 300);
        }
        
        // Animaci√≥n para disminuci√≥n
        function animateDecrease() {
            visitorCountElement.style.transform = 'scale(0.9)';
            visitorCountElement.style.color = '#f44336';
            
            setTimeout(() => {
                visitorCountElement.style.transform = 'scale(1)';
                visitorCountElement.style.color = 'white';
            }, 300);
        }
        
        // Mostrar notificaci√≥n
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'online' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // A√±adir estilos para animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Limpiar visitantes inactivos (m√°s de 30 segundos)
        setInterval(() => {
            if (!isOnline) return;
            
            const now = Date.now();
            const visitorsRef = database.ref('visitors');
            
            visitorsRef.once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const visitors = snapshot.val();
                    let needsUpdate = false;
                    
                    for (const [id, data] of Object.entries(visitors)) {
                        if (now - data.lastSeen > 30000) { // 30 segundos
                            database.ref('visitors/' + id).remove();
                            needsUpdate = true;
                        }
                    }
                    
                    if (needsUpdate) {
                        console.log('Visitantes inactivos eliminados');
                    }
                }
            });
        }, 15000); // Verificar cada 15 segundos
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            connectToFirebase();
            updateLastUpdate();
            
            // Mantener la p√°gina activa (para evitar que se duerma)
            setInterval(updateLastUpdate, 1000);
            
            // Mostrar alerta de configuraci√≥n si falta Firebase
            if (firebaseConfig.apiKey.includes("TU_API_KEY")) {
                showNotification('‚ö†Ô∏è Configura Firebase primero!', 'offline');
            }
        });
        
        // Detectar visibilidad de la pesta√±a
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && isOnline) {
                // Reactualizar cuando la pesta√±a vuelve a ser visible
                const visitorRef = database.ref('visitors/' + sessionId);
                visitorRef.update({
                    lastSeen: Date.now()
                });
            }
        });
    </script>
</body>
</html>