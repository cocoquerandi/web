<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista Previa REPROCANN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }
        
        .container {
            max-width: 794px; /* Ancho A4 */
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            min-height: 1123px; /* Alto A4 */
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        
        .field {
            position: absolute;
            border: 1px solid #ccc;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.95);
            overflow: hidden;
            font-size: 12px;
            line-height: 1.3;
        }
        
        .field-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
            font-size: 10px;
            border-bottom: 1px dotted #ddd;
            padding-bottom: 2px;
        }
        
        .field-value {
            color: #000;
            word-wrap: break-word;
            min-height: 15px;
        }
        
        .signature-img {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #333;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .controls button {
            margin-left: 10px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        Cargando datos...
    </div>
    
    <div class="container" id="pdfContainer">
        <div class="header">
            <h1>FORMULARIO REPROCANN</h1>
            <p>VISTA PREVIA - Documento generado el <span id="currentDate"></span></p>
        </div>
        
        <!-- Los campos se insertar√°n aqu√≠ din√°micamente -->
    </div>
    
    <div class="controls">
        <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
        <button onclick="window.close()">‚úï Cerrar</button>
    </div>

    <script>
        // Coordenadas ajustadas del CSV (aproximadas para vista A4)
        const fieldCoordinates = {
            // Campos del paciente
            paciente_apellidonombre: { x: 40, y: 100, width: 300, height: 25 },
            paciente_doc: { x: 40, y: 140, width: 150, height: 25 },
            paciente_nac: { x: 400, y: 140, width: 150, height: 25 },
            paciente_dom: { x: 40, y: 180, width: 400, height: 25 },
            paciente_telefono_particular: { x: 80, y: 220, width: 120, height: 25 },
            paciente_telefono_celular: { x: 400, y: 220, width: 120, height: 25 },
            paciente_email: { x: 40, y: 260, width: 300, height: 25 },
            paciente_obra_social: { x: 40, y: 300, width: 300, height: 25 },
            
            // Campos del tutor
            tutor_apellido_nombre: { x: 40, y: 360, width: 200, height: 25 },
            tutor_tipo_doc: { x: 300, y: 360, width: 100, height: 25 },
            tutor_nro_doc: { x: 450, y: 360, width: 80, height: 25 },
            tutor_domicilio: { x: 40, y: 400, width: 200, height: 25 },
            tutor_localidad: { x: 280, y: 400, width: 120, height: 25 },
            tutor_provincia: { x: 420, y: 400, width: 100, height: 25 },
            tutor_cp: { x: 550, y: 400, width: 60, height: 25 },
            tutor_vinculo: { x: 200, y: 440, width: 250, height: 25 },
            tutor_telefono_particular: { x: 80, y: 480, width: 120, height: 25 },
            tutor_celular: { x: 400, y: 480, width: 120, height: 25 },
            tutor_email: { x: 40, y: 520, width: 250, height: 25 },
            tutor_obrasocial: { x: 40, y: 560, width: 250, height: 25 },
            
            // Campos del m√©dico
            medico_apellidonombre: { x: 40, y: 620, width: 250, height: 25 },
            medico_doc: { x: 350, y: 620, width: 100, height: 25 },
            medico_matricula: { x: 40, y: 660, width: 150, height: 25 },
            medico_especialidad: { x: 250, y: 660, width: 200, height: 25 },
            medico_tel_particular: { x: 80, y: 700, width: 120, height: 25 },
            medico_tel_cel: { x: 400, y: 700, width: 120, height: 25 },
            medico_email: { x: 80, y: 740, width: 300, height: 25 },
            medico_historiaclinica: { x: 40, y: 780, width: 350, height: 60 },
            medico_diagnostico_ypatologia: { x: 40, y: 850, width: 350, height: 60 },
            medico_tratamiento: { x: 40, y: 920, width: 350, height: 60 },
            medico_justificacion: { x: 200, y: 990, width: 250, height: 40 },
            medico_productoindicado: { x: 40, y: 1040, width: 350, height: 40 },
            
            // Firmas
            medico_firmaclaracion: { x: 40, y: 1100, width: 180, height: 80 },
            medico_sello: { x: 250, y: 1100, width: 150, height: 25 },
            medico_fecha: { x: 420, y: 1100, width: 100, height: 25 },
            paciente_firmaclaracion: { x: 40, y: 1200, width: 180, height: 80 },
            paciente_fecha: { x: 250, y: 1200, width: 100, height: 25 }
        };

        // Cargar datos del formulario
        function loadFormData() {
            try {
                // Intentar obtener datos de sessionStorage
                let formData = sessionStorage.getItem('reprocannFormData');
                
                // Si no hay en sessionStorage, intentar con localStorage
                if (!formData) {
                    formData = localStorage.getItem('reprocann_last_form');
                    updateDebugInfo('Usando datos de localStorage');
                } else {
                    updateDebugInfo('Usando datos de sessionStorage');
                }
                
                if (!formData) {
                    updateDebugInfo('‚ùå No se encontraron datos. Usando datos de
